<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Differential operators in arbitrary orthogonal coordinates systems • calculus</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Differential operators in arbitrary orthogonal coordinates systems">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">calculus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/derivatives.html">High order derivatives of multivariate functions</a>
    </li>
    <li>
      <a href="../articles/differential-operators.html">Differential operators in arbitrary orthogonal coordinates systems</a>
    </li>
    <li>
      <a href="../articles/einstein.html">Einstein summation convention</a>
    </li>
    <li>
      <a href="../articles/hermite.html">Hermite polynomials</a>
    </li>
    <li>
      <a href="../articles/integrals.html">Multiple integrals in arbitrary orthogonal coordinates systems</a>
    </li>
    <li>
      <a href="../articles/ode.html">Ordinary differential equations</a>
    </li>
    <li>
      <a href="../articles/taylor.html">Taylor series of multivariate functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://doi.org/10.18637/jss.v104.i05" class="external-link">JSS Paper</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/eguidotti/calculus/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Differential operators in arbitrary orthogonal
coordinates systems</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/eguidotti/calculus/blob/master/vignettes/differential-operators.Rmd" class="external-link"><code>vignettes/differential-operators.Rmd</code></a></small>
      <div class="hidden name"><code>differential-operators.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://calculus.eguidotti.com">calculus</a></span><span class="op">)</span></span></code></pre></div>
<p>Orthogonal coordinates are a special but extremely common case of
curvilinear coordinates where the coordinate surfaces all meet at right
angles. The chief advantage of non-Cartesian coordinates is that they
can be chosen to match the symmetry of the problem. For example,
spherical coordinates are the most common curvilinear coordinate systems
and are used in Earth sciences, cartography, quantum mechanics,
relativity, and engineering.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> These coordinates may be derived from a set
of Cartesian coordinates by using a transformation that is locally
invertible (a one-to-one map) at each point. This means that one can
convert a point given in a Cartesian coordinate system to its
curvilinear coordinates and back. Differential operators such as the
gradient, divergence, curl, and Laplacian can be transformed from one
coordinate system to another via the usage of scale factors.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> The
package implements these operators in Cartesian, polar, spherical,
cylindrical, parabolic coordinates, and supports arbitrary orthogonal
coordinates systems defined by custom scale factors.</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Curvilinear coordinates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>q</mi><mn>1</mn></msub><mo>,</mo><msub><mi>q</mi><mn>2</mn></msub><mo>,</mo><msub><mi>q</mi><mn>3</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(q_1, q_2, q_3)</annotation></semantics></math>
</th>
<th>Transformation from cartesian
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x, y, z)</annotation></semantics></math>
</th>
<th>Scale factors</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Spherical polar coordinates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo>,</mo><mi>θ</mi><mo>,</mo><mi>ϕ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(r,\theta ,\phi )</annotation></semantics></math>
</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>x</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>r</mi><mo>sin</mo><mi>θ</mi><mo>cos</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>r</mi><mo>sin</mo><mi>θ</mi><mo>sin</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>z</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>r</mi><mo>cos</mo><mi>θ</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">{\begin{aligned}x&amp;=r\sin \theta \cos \phi \\y&amp;=r\sin \theta \sin \phi \\z&amp;=r\cos \theta \end{aligned}}</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>2</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>r</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>3</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>r</mi><mo>sin</mo><mi>θ</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">{\begin{aligned}h_{1}&amp;=1\\h_{2}&amp;=r\\h_{3}&amp;=r\sin \theta \end{aligned}}</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>Cylindrical polar coordinates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo>,</mo><mi>ϕ</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(r,\phi ,z)</annotation></semantics></math>
</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>x</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>r</mi><mo>cos</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>r</mi><mo>sin</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>z</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>z</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">{\begin{aligned}x&amp;=r\cos \phi \\y&amp;=r\sin \phi \\z&amp;=z\end{aligned}}</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>h</mi><mn>3</mn></msub><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>2</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>r</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">{\begin{aligned}h_{1}&amp;=h_{3}=1\\h_{2}&amp;=r\end{aligned}}</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td>Parabolic coordinates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo>,</mo><mi>ϕ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u,v,\phi )</annotation></semantics></math>
</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>x</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>u</mi><mi>v</mi><mo>cos</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>u</mi><mi>v</mi><mo>sin</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>z</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>u</mi><mn>2</mn></msup><mo>−</mo><msup><mi>v</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">{\begin{aligned}x&amp;=uv\cos \phi \\y&amp;=uv\sin \phi \\z&amp;={\frac  {1}{2}}(u^{2}-v^{2})\end{aligned}}</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>h</mi><mn>2</mn></msub><mo>=</mo><msqrt><mrow><msup><mi>u</mi><mn>2</mn></msup><mo>+</mo><msup><mi>v</mi><mn>2</mn></msup></mrow></msqrt></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>3</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>u</mi><mi>v</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">{\begin{aligned}h_{1}&amp;=h_{2}={\sqrt  {u^{2}+v^{2}}}\\h_{3}&amp;=uv\end{aligned}}</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>Parabolic cylindrical coordinates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u,v,z)</annotation></semantics></math>
</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>x</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>u</mi><mn>2</mn></msup><mo>−</mo><msup><mi>v</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>y</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>u</mi><mi>v</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>z</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>z</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">{\begin{aligned}x&amp;={\frac  {1}{2}}(u^{2}-v^{2})\\y&amp;=uv\\z&amp;=z\end{aligned}}</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>h</mi><mn>2</mn></msub><mo>=</mo><msqrt><mrow><msup><mi>u</mi><mn>2</mn></msup><mo>+</mo><msup><mi>v</mi><mn>2</mn></msup></mrow></msqrt></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>h</mi><mn>3</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mn>1</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">{\begin{aligned}h_{1}&amp;=h_{2}={\sqrt  {u^{2}+v^{2}}}\\h_{3}&amp;=1\end{aligned}}</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="gradient">Gradient<a class="anchor" aria-label="anchor" href="#gradient"></a>
</h2>
<p>The gradient of a scalar-valued function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is the vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>∇</mi><mi>F</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>i</mi></msub><annotation encoding="application/x-tex">(\nabla F)_i</annotation></semantics></math>
whose components are the partial derivatives of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
with respect to each variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
In arbitrary orthogonal coordinate systems, the gradient is expressed in
terms of the scale factors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>i</mi></msub><annotation encoding="application/x-tex">h_i</annotation></semantics></math>
as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>∇</mi><mi>F</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>i</mi></msub><mo>=</mo><mfrac><mn>1</mn><msub><mi>h</mi><mi>i</mi></msub></mfrac><msub><mi>∂</mi><mi>i</mi></msub><mi>F</mi></mrow><annotation encoding="application/x-tex">(\nabla F)_i = \frac{1}{h_i}\partial_iF</annotation></semantics></math></p>
<p>The function <a href="https://calculus.eguidotti.com/reference/gradient.html"><code>gradient</code></a>
implements the symbolic and numeric gradient of <code>functions</code>,
<code>expressions</code> and <code>characters</code>. In Cartesian
coordinates:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="st">"x*y*z"</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "y * z" "x * z" "x * y"</span></span></code></pre></div>
<p>and in spherical coordinates:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="st">"x*y*z"</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span>, coordinates <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1/1 * (y * z)"          "1/x * (x * z)"          "1/(x*sin(y)) * (x * y)"</span></span></code></pre></div>
<p>To support arbitrary orthogonal coordinate systems, it is possible to
pass custom scale factors to the argument <code>coordinates</code>. For
instance, the following call is equivalent to the previous example in
spherical coordinates where the scale factors are now explicitly
specified:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="st">"x*y*z"</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span>, coordinates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">"x"</span>,<span class="st">"x*sin(y)"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1/(1) * (y * z)"        "1/(x) * (x * z)"        "1/(x*sin(y)) * (x * y)"</span></span></code></pre></div>
<p>Numerical methods are applied when working with
<code>functions</code> with the same sintax introduced for <a href="https://calculus.eguidotti.com/reference/derivative.html">derivatives</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="va">x</span><span class="op">*</span><span class="va">y</span><span class="op">*</span><span class="va">z</span></span>
<span><span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="va">pi</span><span class="op">/</span><span class="fl">2</span>, z <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, coordinates <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000000 0.000000 1.570796</span></span></code></pre></div>
<p>or in vectorized form:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">pi</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>, coordinates <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000000 0.000000 1.570796</span></span></code></pre></div>
<p>When the function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is a tensor-valued function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub></mrow></msub><annotation encoding="application/x-tex">F_{d_1,\dots,d_n}</annotation></semantics></math>,
the gradient is computed for each scalar component.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>∇</mi><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>i</mi></msub><mo>=</mo><mfrac><mn>1</mn><msub><mi>h</mi><mi>i</mi></msub></mfrac><msub><mi>∂</mi><mi>i</mi></msub><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">(\nabla F_{d_1,\dots,d_n})_i = \frac{1}{h_i}\partial_iF_{d_1,\dots,d_n}</annotation></semantics></math></p>
<p>In particular, this reduces to the Jacobian matrix for vector-valued
functions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><msub><mi>d</mi><mn>1</mn></msub></msub><annotation encoding="application/x-tex">F_{d_1}</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]    2    3    6</span></span>
<span><span class="co">#&gt; [2,]    1    1    1</span></span></code></pre></div>
<p>that may be expressed in arbitrary orthogonal coordinate systems.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gradient.html">gradient</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, coordinates <span class="op">=</span> <span class="st">"cylindrical"</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]      [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]    2 1.0000000    6</span></span>
<span><span class="co">#&gt; [2,]    1 0.3333333    1</span></span></code></pre></div>
<div class="section level3">
<h3 id="jacobian">Jacobian<a class="anchor" aria-label="anchor" href="#jacobian"></a>
</h3>
<p>The function <a href="https://calculus.eguidotti.com/reference/jacobian.html"><code>jacobian</code></a>
is a wrapper for <a href="https://calculus.eguidotti.com/reference/gradient.html"><code>gradient</code></a>
that always returns the Jacobian as a matrix, even in the case of
unidimensional scalar-valued functions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="fu"><a href="../reference/jacobian.html">jacobian</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hessian">Hessian<a class="anchor" aria-label="anchor" href="#hessian"></a>
</h3>
<p>In Cartesian coordinates, the Hessian of a scalar-valued function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is the square matrix of second-order partial derivatives:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>F</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>∂</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>F</mi></mrow><annotation encoding="application/x-tex">(H(F))_{ij} = \partial_{ij}F</annotation></semantics></math></p>
<p>It might be tempting to apply the definition of the Hessian as the
Jacobian of the gradient to write it in terms of the scale factors.
However, this results in a Hessian matrix that is not symmetric and
ignores the distinction between vector and covectors in tensor analysis.
The generalization to arbitrary coordinate system is not implemented and
only Cartesian coordinates are supported:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="va">x</span><span class="op">*</span><span class="va">y</span><span class="op">*</span><span class="va">z</span></span>
<span><span class="fu"><a href="../reference/hessian.html">hessian</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3</span>, y <span class="op">=</span> <span class="fl">2</span>, z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;               [,1]          [,2]          [,3]</span></span>
<span><span class="co">#&gt; [1,] -1.918057e-11  1.000000e+00  2.000000e+00</span></span>
<span><span class="co">#&gt; [2,]  1.000000e+00 -4.315627e-11  3.000000e+00</span></span>
<span><span class="co">#&gt; [3,]  2.000000e+00  3.000000e+00 -1.726251e-10</span></span></code></pre></div>
<p>When the function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is a tensor-valued function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub></mrow></msub><annotation encoding="application/x-tex">F_{d_1,\dots,d_n}</annotation></semantics></math>,
the <a href="https://calculus.eguidotti.com/reference/hessian.html"><code>hessian</code></a>
is computed for each scalar component.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>∂</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">(H(F_{d_1,\dots,d_n}))_{ij} = \partial_{ij}F_{d_1,\dots,d_n}</annotation></semantics></math></p>
<p>In this case, the function returns an <code>array</code> of Hessian
matrices:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="va">y</span><span class="op">*</span><span class="va">z</span>, <span class="va">x</span><span class="op">+</span><span class="va">y</span><span class="op">+</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hessian.html">hessian</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3</span>, y <span class="op">=</span> <span class="fl">2</span>, z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>that can be extracted with the corresponding indices.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span><span class="op">[</span><span class="fl">1</span>,,<span class="op">]</span></span>
<span><span class="co">#&gt;               [,1]          [,2]          [,3]</span></span>
<span><span class="co">#&gt; [1,] -1.918057e-11  1.000000e+00  2.000000e+00</span></span>
<span><span class="co">#&gt; [2,]  1.000000e+00 -4.315627e-11  3.000000e+00</span></span>
<span><span class="co">#&gt; [3,]  2.000000e+00  3.000000e+00 -1.726251e-10</span></span>
<span><span class="va">h</span><span class="op">[</span><span class="fl">2</span>,,<span class="op">]</span></span>
<span><span class="co">#&gt;               [,1]          [,2]          [,3]</span></span>
<span><span class="co">#&gt; [1,] -4.242789e-12  2.932800e-12 -8.683390e-12</span></span>
<span><span class="co">#&gt; [2,]  2.932800e-12 -7.066143e-11  2.825347e-12</span></span>
<span><span class="co">#&gt; [3,] -8.683390e-12  2.825347e-12 -1.848667e-10</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="divergence">Divergence<a class="anchor" aria-label="anchor" href="#divergence"></a>
</h2>
<p>The divergence of a vector-valued function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>i</mi></msub><annotation encoding="application/x-tex">F_i</annotation></semantics></math>
produces a scalar value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>∇</mi><mo>⋅</mo><mi>F</mi></mrow><annotation encoding="application/x-tex">\nabla \cdot F</annotation></semantics></math>
representing the volume density of the outward flux of the vector field
from an infinitesimal volume around a given point.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> In terms of scale
factors, it is expressed as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>∇</mi><mo>⋅</mo><mi>F</mi><mo>=</mo><mfrac><mn>1</mn><mi>J</mi></mfrac><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>∂</mi><mi>i</mi></msub><mo minsize="3.0" maxsize="3.0" stretchy="false" form="prefix">(</mo><mfrac><mi>J</mi><msub><mi>h</mi><mi>i</mi></msub></mfrac><msub><mi>F</mi><mi>i</mi></msub><mo minsize="3.0" maxsize="3.0" stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\nabla \cdot F = \frac{1}{J}\sum_i\partial_i\Biggl(\frac{J}{h_i}F_i\Biggl)</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>=</mo><msub><mo>∏</mo><mi>i</mi></msub><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">J=\prod_ih_i</annotation></semantics></math>.
When
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is an <code>array</code> of vector-valued functions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">F_{d_1,\dots,d_n,i}</annotation></semantics></math>,
the <a href="https://calculus.eguidotti.com/reference/divergence.html"><code>divergence</code></a>
is computed for each vector:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>∇</mi><mo>⋅</mo><mi>F</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mi>J</mi></mfrac><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>∂</mi><mi>i</mi></msub><mo minsize="3.0" maxsize="3.0" stretchy="false" form="prefix">(</mo><mfrac><mi>J</mi><msub><mi>h</mi><mi>i</mi></msub></mfrac><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub><mo>,</mo><mi>i</mi></mrow></msub><mo minsize="3.0" maxsize="3.0" stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>J</mi></mfrac><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>∂</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>J</mi><msubsup><mi>h</mi><mi>i</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub><mo>,</mo><mi>i</mi></mrow></msub><mo>+</mo><mi>J</mi><msubsup><mi>h</mi><mi>i</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>∂</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub><mo>,</mo><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">(\nabla \cdot F)_{d_1,\dots,d_n} = \frac{1}{J}\sum_i\partial_i\Biggl(\frac{J}{h_i}F_{d_1,\dots,d_n,i}\Biggl)=\frac{1}{J}\sum_i\partial_i(Jh_i^{-1})F_{d_1,\dots,d_n,i}+Jh_i^{-1}\partial_i(F_{d_1,\dots,d_n,i})</annotation></semantics></math></p>
<p>where the last equality is preferable in practice as the derivatives
of the scale factor can be computed symbolically and the computation of
the derivatives of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is more efficient than the direct computation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>∂</mi><mi>i</mi></msub><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><mfrac><mi>J</mi><msub><mi>h</mi><mi>i</mi></msub></mfrac><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub><mo>,</mo><mi>i</mi></mrow></msub><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\partial_i\bigl(\frac{J}{h_i}F_{d_1,\dots,d_n,i}\bigl)</annotation></semantics></math>
via finite differences. In Cartesian coordinates:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x^2"</span>, <span class="st">"y^2"</span>, <span class="st">"z^2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/divergence.html">divergence</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2 * x + 2 * y + 2 * z"</span></span></code></pre></div>
<p>In polar coordinates:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sqrt(r)/10"</span>, <span class="st">"sqrt(r)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/divergence.html">divergence</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r"</span>,<span class="st">"phi"</span><span class="op">)</span>, coordinates <span class="op">=</span> <span class="st">"polar"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "(0.5 * r^-0.5/10 * r + (sqrt(r)/10)) / (1*r)"</span></span></code></pre></div>
<p>And for tensors of vector-valued functions:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x^2"</span>,<span class="st">"y^2"</span>,<span class="st">"z^2"</span>,<span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/divergence.html">divergence</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2 * x + 2 * y + 2 * z" "1 + 1 + 1"</span></span></code></pre></div>
<p>The same syntax holds for <code>functions</code> where numerical
methods are automatically applied:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,<span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span>,<span class="va">y</span><span class="op">^</span><span class="fl">2</span>,<span class="va">z</span><span class="op">^</span><span class="fl">2</span>,<span class="va">x</span>,<span class="va">y</span>,<span class="va">z</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/divergence.html">divergence</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, z <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3.004132e-21 3.000000e+00</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="curl">Curl<a class="anchor" aria-label="anchor" href="#curl"></a>
</h2>
<p>The curl of a vector-valued function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi>i</mi></msub><annotation encoding="application/x-tex">F_i</annotation></semantics></math>
at a point is represented by a vector whose length and direction denote
the magnitude and axis of the maximum circulation.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> In 2 dimensions, the
curl is written in terms of the scale factors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
and the <a href="https://calculus.eguidotti.com/reference/epsilon.html">Levi-Civita
symbol</a>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math>
as follows:</p>
<p><span class="math display">$$\nabla \times F =
\frac{1}{h_1h_2}\sum_{ij}\epsilon_{ij}\partial_i\Bigl(h_jF_j\Bigl)=
\frac{1}{h_1h_2}\Biggl(\partial_1\Bigl(h_2F_2\Bigl)-\partial_2\Bigl(h_1F_1\Bigl)\Biggl)$$</span></p>
<p>In 3 dimensions:</p>
<p><span class="math display">$$(\nabla \times F)_k =
\frac{h_k}{J}\sum_{ij}\epsilon_{ijk}\partial_i\Bigl(h_jF_j\Bigl)$$</span></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>=</mo><msub><mo>∏</mo><mi>i</mi></msub><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">J=\prod_i h_i</annotation></semantics></math>.
This suggests to implement the <a href="https://calculus.eguidotti.com/reference/curl.html"><code>curl</code></a>
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">m+2</annotation></semantics></math>
dimensions in such a way that the formula reduces correctly to the
previous cases:</p>
<p><span class="math display">$$(\nabla \times F)_{k_1\dots k_m} =
\frac{h_{k_1}\cdots h_{k_m}}{J}\sum_{ij}\epsilon_{ijk_1\dots
k_m}\partial_i\Bigl(h_jF_j\Bigl)$$</span></p>
<p>And in particular, when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is an <code>array</code> of vector-valued functions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">F_{d_1,\dots,d_n,i}</annotation></semantics></math>
the <a href="https://calculus.eguidotti.com/reference/curl.html"><code>curl</code></a>
is computed for each vector:</p>
<p><span class="math display">$$
\begin{split}
(\nabla \times F)_{d_1\dots d_n,k_1\dots k_m} &amp; =\\
&amp;=\frac{h_{k_1}\cdots h_{k_m}}{J}\sum_{ij}\epsilon_{ijk_1\dots
k_m}\partial_i\Bigl(h_jF_{d_1\dots d_n,j}\Bigl) \\
&amp;=\sum_{ij}\frac{1}{h_ih_j}\epsilon_{ijk_1\dots
k_m}\partial_i\Bigl(h_jF_{d_1\dots d_n,j}\Bigl) \\
&amp;=\sum_{ij}\frac{1}{h_ih_j}\epsilon_{ijk_1\dots
k_m}\Bigl(\partial_i(h_j)F_{d_1\dots d_n,j}+h_j\partial_i(F_{d_1\dots
d_n,j})\Bigl)
\end{split}
$$</span></p>
<p>where the last equality is preferable in practice as the derivatives
of the scale factor can be computed symbolically and the computation of
the derivatives of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is more efficient than the direct computation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>∂</mi><mi>i</mi></msub><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><msub><mi>h</mi><mi>j</mi></msub><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mi>…</mi><msub><mi>d</mi><mi>n</mi></msub><mo>,</mo><mi>j</mi></mrow></msub><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\partial_i\bigl(h_jF_{d_1\dots d_n,j}\bigl)</annotation></semantics></math>
via finite differences. In 2-dimensional Cartesian coordinates:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x^3*y^2"</span>,<span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/curl.html">curl</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "(1) * 1 + (x^3 * (2 * y)) * -1"</span></span></code></pre></div>
<p>In 3 dimensions, for an irrotational vector field:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"-y"</span>,<span class="st">"z"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/curl.html">curl</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0" "0" "0"</span></span></code></pre></div>
<p>And for tensors of vector-valued functions:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"-y"</span>,<span class="st">"z"</span>,<span class="st">"x^3*y^2"</span>,<span class="st">"x"</span>,<span class="st">"0"</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/curl.html">curl</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]                            </span></span>
<span><span class="co">#&gt; [1,] "0"  "0"  "0"                             </span></span>
<span><span class="co">#&gt; [2,] "0"  "0"  "(1) * 1 + (x^3 * (2 * y)) * -1"</span></span></code></pre></div>
<p>The same syntax holds for <code>functions</code> where numerical
methods are automatically applied and for arbitrary orthogonal
coordinate systems as shown in the previous sections.</p>
</div>
<div class="section level2">
<h2 id="laplacian">Laplacian<a class="anchor" aria-label="anchor" href="#laplacian"></a>
</h2>
<p>The Laplacian is a differential operator given by the divergence of
the gradient of a scalar-valued function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>,
resulting in a scalar value giving the flux density of the gradient flow
of a function. The Laplacian occurs in differential equations that
describe many physical phenomena, such as electric and gravitational
potentials, the diffusion equation for heat and fluid flow, wave
propagation, and quantum mechanics.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> In terms of the scale factor, the operator
is written as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>∇</mi><mn>2</mn></msup><mi>F</mi><mo>=</mo><mfrac><mn>1</mn><mi>J</mi></mfrac><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>∂</mi><mi>i</mi></msub><mo minsize="3.0" maxsize="3.0" stretchy="false" form="prefix">(</mo><mfrac><mi>J</mi><msubsup><mi>h</mi><mi>i</mi><mn>2</mn></msubsup></mfrac><msub><mi>∂</mi><mi>i</mi></msub><mi>F</mi><mo minsize="3.0" maxsize="3.0" stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\nabla^2F = \frac{1}{J}\sum_i\partial_i\Biggl(\frac{J}{h_i^2}\partial_iF\Biggl)</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>=</mo><msub><mo>∏</mo><mi>i</mi></msub><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">J=\prod_ih_i</annotation></semantics></math>.
When the function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is a tensor-valued function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>n</mi></msub></mrow></msub><annotation encoding="application/x-tex">F_{d_1,\dots,d_n}</annotation></semantics></math>,
the <a href="https://calculus.eguidotti.com/reference/laplacian.html"><code>laplacian</code></a>
is computed for each scalar component:</p>
<p><span class="math display">$$(\nabla^2F)_{d_1\dots d_n} =
\frac{1}{J}\sum_i\partial_i\Biggl(\frac{J}{h_i^2}\partial_iF_{d_1\dots
d_n}\Biggl)=\frac{1}{J}\sum_i\partial_i\Bigl(Jh_i^{-2}\Bigl)\partial_iF_{d_1\dots
d_n}+Jh_i^{-2}\partial^2_iF_{d_1\dots d_n}$$</span></p>
<p>where the last equality is preferable in practice as the derivatives
of the scale factor can be computed symbolically and the computation of
the derivatives of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is more efficient than the direct computation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>∂</mi><mi>i</mi></msub><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><mfrac><mi>J</mi><msubsup><mi>h</mi><mi>i</mi><mn>2</mn></msubsup></mfrac><msub><mi>∂</mi><mi>i</mi></msub><mi>F</mi><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\partial_i\bigl(\frac{J}{h_i^2}\partial_iF\bigl)</annotation></semantics></math>
via finite differences. In Cartesian coordinates:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="st">"x^3+y^3+z^3"</span></span>
<span><span class="fu"><a href="../reference/laplacian.html">laplacian</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "3 * (2 * x) + 3 * (2 * y) + 3 * (2 * z)"</span></span></code></pre></div>
<p>And for tensors of scalar-valued functions:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x^3+y^3+z^3"</span>, <span class="st">"x^2+y^2+z^2"</span>, <span class="st">"y^2"</span>, <span class="st">"z*x^2"</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/laplacian.html">laplacian</a></span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]                                      [,2]   </span></span>
<span><span class="co">#&gt; [1,] "3 * (2 * x) + 3 * (2 * y) + 3 * (2 * z)" "2"    </span></span>
<span><span class="co">#&gt; [2,] "2 + 2 + 2"                               "z * 2"</span></span></code></pre></div>
<p>The same syntax holds for <code>functions</code> where numerical
methods are automatically applied and for arbitrary orthogonal
coordinate systems as shown in the previous sections.</p>
</div>
<div class="section level2">
<h2 id="cite-as">Cite as<a class="anchor" aria-label="anchor" href="#cite-as"></a>
</h2>
<p>Guidotti E (2022). “calculus: High-Dimensional Numerical and Symbolic
Calculus in R.” <em>Journal of Statistical Software</em>,
<em>104</em>(5), 1-37. <a href="https://doi.org/10.18637/jss.v104.i05" class="external-link">doi:10.18637/jss.v104.i05</a></p>
<p>A BibTeX entry for LaTeX users is</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bibtex"><code class="sourceCode bibtex"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="va">@Article</span>{<span class="ot">calculus</span>,</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="dt">title</span> = {{calculus}: High-Dimensional Numerical and Symbolic Calculus in {R}},</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="dt">author</span> = {Emanuele Guidotti},</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  <span class="dt">journal</span> = {Journal of Statistical Software},</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>  <span class="dt">year</span> = {2022},</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>  <span class="dt">volume</span> = {104},</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>  <span class="dt">number</span> = {5},</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>  <span class="dt">pages</span> = {1--37},</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>  <span class="dt">doi</span> = {10.18637/jss.v104.i05},</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p><a href="https://en.wikipedia.org/wiki/Curvilinear_coordinates" class="external-link uri">https://en.wikipedia.org/wiki/Curvilinear_coordinates</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><a href="https://en.wikipedia.org/wiki/Orthogonal_coordinates" class="external-link uri">https://en.wikipedia.org/wiki/Orthogonal_coordinates</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><a href="https://en.wikipedia.org/wiki/Divergence" class="external-link uri">https://en.wikipedia.org/wiki/Divergence</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p><a href="https://en.wikipedia.org/wiki/Curl_(mathematics)" class="external-link uri">https://en.wikipedia.org/wiki/Curl_(mathematics)</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p><a href="https://en.wikipedia.org/wiki/Laplace_operator" class="external-link uri">https://en.wikipedia.org/wiki/Laplace_operator</a><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://eguidotti.com" class="external-link">Emanuele Guidotti</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
